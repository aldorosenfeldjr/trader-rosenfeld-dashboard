<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Trader Rosenfeld - Combined Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            color: #e2e8f0;
            padding: 0;
            min-height: 100vh;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 40px;
        }

        .section {
            background: rgba(30, 41, 59, 0.6);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid rgba(148, 163, 184, 0.1);
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 8px;
            background: linear-gradient(135deg, #f1f5f9, #cbd5e1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .section-subtitle {
            font-size: 0.95rem;
            color: #94a3b8;
            margin-bottom: 25px;
        }

        .profit { color: #4ade80 !important; }
        .loss { color: #f87171 !important; }
        .neutral { color: #94a3b8 !important; }
        

        .navbar {
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(10px);
            padding: 10px 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            position: sticky;
            top: 0;
            z-index: 1000;
            border-bottom: 1px solid rgba(148, 163, 184, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 12px;
            min-height: 60px;
        }

        .navbar > div:first-child { flex-shrink: 1; min-width: 0; }
        .navbar > div:last-child { flex-shrink: 0; }

        .navbar h1 {
            font-size: 1.1rem;
            font-weight: 700;
            background: linear-gradient(135deg, #60a5fa, #a78bfa);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .navbar .subtitle {
            font-size: 0.75rem;
            color: #94a3b8;
            margin-top: 2px;
            white-space: nowrap;
        }

        .navbar-toggle { display: none; }
        .navbar-controls { display: flex; align-items: center; }
        

        .exec-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .exec-card {
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.8), rgba(15, 23, 42, 0.9));
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(148, 163, 184, 0.1);
            transition: all 0.3s ease;
        }

        .exec-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
            border-color: rgba(96, 165, 250, 0.3);
        }

        .exec-card-label {
            font-size: 0.85rem;
            color: #94a3b8;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .exec-card-value {
            font-size: 2rem;
            font-weight: 700;
            color: #f1f5f9;
            margin-bottom: 4px;
        }

        .exec-card-subtitle {
            font-size: 0.8rem;
            color: #64748b;
        }
        

        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85rem;
        }

        .data-table th {
            background: rgba(15, 23, 42, 0.8);
            color: #94a3b8;
            font-weight: 600;
            text-align: left;
            padding: 12px 10px;
            border-bottom: 2px solid rgba(148, 163, 184, 0.2);
            white-space: nowrap;
        }

        .data-table td {
            padding: 10px;
            border-bottom: 1px solid rgba(148, 163, 184, 0.1);
            color: #e2e8f0;
        }

        .data-table tr:hover { background: rgba(96, 165, 250, 0.05); }
        .data-table .pair-name { font-weight: 600; color: #60a5fa; }

        .version-badge {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: 700;
            background: linear-gradient(135deg, #60a5fa, #a78bfa);
            color: white;
        }

        .extra-indicators {
            font-size: 0.75rem;
            color: #94a3b8;
            max-width: 250px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        .extra-indicators:hover {
            white-space: normal;
            overflow: visible;
            position: relative;
            z-index: 10;
            background: #1e293b;
            padding: 4px;
            border-radius: 4px;
        }

        .table-scroll {
            max-height: 500px;
            overflow-y: auto;
            border-radius: 8px;
        }

        .table-scroll::-webkit-scrollbar { width: 8px; }
        .table-scroll::-webkit-scrollbar-track { background: rgba(15, 23, 42, 0.5); border-radius: 4px; }
        .table-scroll::-webkit-scrollbar-thumb { background: rgba(148, 163, 184, 0.3); border-radius: 4px; }
        

        .chart-container {
            height: 400px;
            position: relative;
            margin: 20px 0;
        }

        .chart-legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 15px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85rem;
            color: #94a3b8;
        }

        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 2px;
        }
        

        .analysis-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
        }

        .analysis-card {
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.7), rgba(15, 23, 42, 0.8));
            border-radius: 16px;
            padding: 25px;
            border: 1px solid rgba(148, 163, 184, 0.1);
            transition: all 0.3s ease;
        }

        .analysis-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.3);
        }

        .analysis-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(148, 163, 184, 0.1);
        }

        .pair-name-large {
            font-size: 1.5rem;
            font-weight: 700;
            color: #60a5fa;
        }

        .risk-badge {
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .risk-badge.profit { background: rgba(74, 222, 128, 0.2); color: #4ade80; }
        .risk-badge.loss { background: rgba(248, 113, 113, 0.2); color: #f87171; }
        .risk-badge.neutral { background: rgba(148, 163, 184, 0.2); color: #94a3b8; }

        .metric-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid rgba(148, 163, 184, 0.05);
        }

        .metric-label { color: #94a3b8; font-size: 0.9rem; }
        .metric-value { font-weight: 600; color: #f1f5f9; }

        .analysis-insight {
            margin-top: 15px;
            padding: 12px;
            background: rgba(96, 165, 250, 0.1);
            border-radius: 8px;
            border-left: 3px solid #60a5fa;
        }

        .analysis-insight p {
            font-size: 0.85rem;
            color: #cbd5e1;
            font-style: italic;
        }
        

        .filters-inline {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: nowrap;
        }

        .filter-inline-item {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .filter-inline-label {
            font-size: 0.7rem;
            color: #cbd5e1;
            font-weight: 500;
            white-space: nowrap;
        }

        .custom-dropdown {
            position: relative;
            min-width: 100px;
            max-width: 130px;
        }

        .dropdown-display {
            padding: 4px 8px;
            background: rgba(30, 41, 59, 0.95);
            border: 1px solid rgba(148, 163, 184, 0.3);
            border-radius: 4px;
            color: #f1f5f9;
            font-size: 0.7rem;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 26px;
            transition: all 0.2s ease;
        }

        .dropdown-display:hover { border-color: #60a5fa; }

        .dropdown-options {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            margin-top: 4px;
            background: rgba(30, 41, 59, 0.98);
            border: 1px solid rgba(148, 163, 184, 0.3);
            border-radius: 6px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            max-height: 250px;
            overflow-y: auto;
            z-index: 9999;
        }

        .dropdown-options.show { display: block; }

        .dropdown-option {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            color: #f1f5f9;
            font-size: 0.85rem;
            cursor: pointer;
            transition: background 0.15s ease;
        }

        .dropdown-option:hover { background: rgba(96, 165, 250, 0.15); }
        .dropdown-option input[type="checkbox"] { margin-right: 8px; cursor: pointer; }

        .filter-inline-input {
            padding: 4px 6px;
            background: rgba(30, 41, 59, 0.8);
            border: 1px solid rgba(148, 163, 184, 0.3);
            border-radius: 4px;
            color: #f1f5f9;
            font-size: 0.65rem;
            width: 120px;
            height: 26px;
            transition: all 0.2s ease;
        }

        .filter-inline-input:focus { border-color: #60a5fa; outline: none; }

        .filter-inline-reset {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            height: 26px;
        }

        .filter-inline-count {
            font-size: 0.7rem;
            color: #94a3b8;
            white-space: nowrap;
            padding-left: 6px;
            border-left: 1px solid rgba(148, 163, 184, 0.2);
        }

        .filter-inline-count strong { color: #f1f5f9; }
        

        .version-toggle {
            display: flex;
            gap: 6px;
            margin-right: 12px;
        }

        .version-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 6px 10px;
            background: rgba(30, 41, 59, 0.8);
            border: 2px solid rgba(148, 163, 184, 0.2);
            border-radius: 8px;
            color: #94a3b8;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 60px;
        }

        .version-btn:hover {
            border-color: rgba(96, 165, 250, 0.5);
            background: rgba(96, 165, 250, 0.1);
        }

        .version-btn.active {
            border-color: #60a5fa;
            background: rgba(96, 165, 250, 0.2);
            color: #f1f5f9;
        }

        .version-btn-icon { font-size: 1rem; margin-bottom: 2px; }
        .version-btn-text { font-size: 0.8rem; font-weight: 700; }
        .version-btn-subtitle { font-size: 0.55rem; color: #64748b; white-space: nowrap; }
        .version-btn.active .version-btn-subtitle { color: #94a3b8; }
        

        .export-btn {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
        }

        .export-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
        }
        

        @media (max-width: 1200px) {
            .exec-grid { grid-template-columns: repeat(2, 1fr); }
        }

        @media (max-width: 768px) {
            .container { padding: 15px; }
            .section { padding: 20px; margin-bottom: 20px; border-radius: 12px; }
            .section-title { font-size: 1.2rem; }
            .exec-grid { grid-template-columns: 1fr; gap: 12px; }
            .exec-card { padding: 16px; }
            .exec-card-value { font-size: 1.6rem; }
            .chart-container { height: 300px; }
            .analysis-grid { grid-template-columns: 1fr; gap: 16px; }

            .navbar { flex-direction: column; padding: 10px; }
            .navbar > div:first-child { width: 100%; text-align: center; }
            .navbar-controls { width: 100%; justify-content: center; flex-wrap: wrap; }
            .version-toggle { justify-content: center; margin: 10px 0; }

            .filters-inline {
                flex-direction: column;
                align-items: stretch;
                gap: 10px;
                width: 100%;
            }

            .filter-inline-item { width: 100%; justify-content: space-between; }
            .filter-inline-input { flex: 1; width: auto; }
            .filter-inline-reset { width: 100%; margin-top: 4px; }

            .table-scroll { overflow-x: auto; -webkit-overflow-scrolling: touch; }
            .data-table { min-width: 800px; font-size: 0.7rem; }
            .data-table th, .data-table td { padding: 6px 4px; }
        }

        @media (max-width: 480px) {
            .navbar h1 { font-size: 1rem; }
            .exec-card-value { font-size: 1.4rem; }
            .chart-container { height: 250px; }
            .version-btn { min-width: 50px; padding: 4px 6px; }
            .version-btn-text { font-size: 0.7rem; }
        }

        @media print {
            body { background: white; }
            .navbar { position: relative; background: rgba(15, 23, 42, 1); }
            .section { page-break-inside: avoid; }
        }
        
</style>
    <style>
        #lockScreen {
            overflow: hidden !important;
            position: fixed !important;
            top: 0; left: 0; right: 0; bottom: 0;
            z-index: 9999;
        }

        body.locked > *:not(#lockScreen) { display: none !important; }

        body.locked {
            overflow: hidden !important;
            position: fixed !important;
            width: 100% !important;
            height: 100% !important;
        }

        html.locked { overflow: hidden !important; }
        </style>
</head>
<body>
    <div class="navbar">
        <div>
            <h1>Trader Rosenfeld - V1 (EMA200 + RSI%)</h1>
            <div class="subtitle">Generated on 2026-02-13 20:56 | Combined Dashboard</div>
        </div>
        <button class="navbar-toggle" onclick="toggleNavbarControls()" aria-label="Toggle menu">
            <span></span><span></span><span></span>
        </button>
        <div class="navbar-controls" id="navbarControls">
            
        <div class="version-toggle">
            <button class="version-btn active" id="btnV1" onclick="switchVersion('v1')">
                <span class="version-btn-icon">ðŸ“Š</span>
                <span class="version-btn-text">V1</span>
                <span class="version-btn-subtitle">EMA200 + RSI%</span>
            </button>
            <button class="version-btn" id="btnV2" onclick="switchVersion('v2')">
                <span class="version-btn-icon">ðŸ“ˆ</span>
                <span class="version-btn-text">V2</span>
                <span class="version-btn-subtitle">ATR% + Direction</span>
            </button>
            <button class="version-btn" id="btnV3" onclick="switchVersion('v3')">
                <span class="version-btn-icon">ðŸŽ¯</span>
                <span class="version-btn-text">V3</span>
                <span class="version-btn-subtitle">ATR% + Trailing</span>
            </button>
            <button class="version-btn" id="btnV4" onclick="switchVersion('v4')">
                <span class="version-btn-icon">âš¡</span>
                <span class="version-btn-text">V4</span>
                <span class="version-btn-subtitle">EMA + Trailing</span>
            </button>
            <button class="version-btn" id="btnV5" onclick="switchVersion('v5')">
                <span class="version-btn-icon">ðŸš€</span>
                <span class="version-btn-text">V5</span>
                <span class="version-btn-subtitle">ATR% + 30min</span>
            </button>
            <button class="version-btn" id="btnV6" onclick="switchVersion('v6')">
                <span class="version-btn-icon">ðŸ’Ž</span>
                <span class="version-btn-text">V6</span>
                <span class="version-btn-subtitle">Dynamic Trail</span>
            </button>
        </div>
            <div class="filters-inline">
                <div class="filter-inline-item">
                    <span class="filter-inline-label">Par:</span>
                    <div class="custom-dropdown" id="pairDropdown">
                        <div class="dropdown-display" onclick="togglePairDropdown()">
                            <span id="pairDropdownText">Todos os pares</span>
                            <span class="dropdown-arrow">â–¼</span>
                        </div>
                        <div class="dropdown-options" id="pairDropdownOptions">
                            <label class="dropdown-option"><input type="checkbox" value="ALL" checked onchange="handlePairSelection(this)"> Todos</label>

                        </div>
                    </div>
                </div>
                <div class="filter-inline-item">
                    <span class="filter-inline-label">De:</span>
                    <input type="datetime-local" id="dateFrom" class="filter-inline-input" value="2026-02-13T17:56" onchange="applyFilters()">
                </div>
                <div class="filter-inline-item">
                    <span class="filter-inline-label">AtÃ©:</span>
                    <input type="datetime-local" id="dateTo" class="filter-inline-input" value="2026-02-13T17:56" onchange="applyFilters()">
                </div>
                <button class="filter-inline-reset" onclick="resetFilters()">â†º</button>
                <div class="filter-inline-count">
                    <span id="filteredCount">0</span>/<span id="totalCount">0</span>
                </div>
            </div>
        </div>
    </div>
    <div class="container">
        <div class="section">
            <div class="section-title">Executive Summary</div>
            <div class="section-subtitle">Cumulative performance since trading started</div>

            <div class="exec-grid">
                <div class="exec-card">
                    <div class="exec-card-label">Total Trades</div>
                    <div class="exec-card-value">0</div>
                    <div class="exec-card-subtitle">Closed positions</div>
                </div>

                <div class="exec-card">
                    <div class="exec-card-label">Win Rate</div>
                    <div class="exec-card-value loss">0.0%</div>
                    <div class="exec-card-subtitle">0 TPs vs 0 SLs</div>
                </div>

                <div class="exec-card">
                    <div class="exec-card-label">Total P&L</div>
                    <div class="exec-card-value profit">$0.00</div>
                    <div class="exec-card-subtitle">Cumulative net profit</div>
                </div>

                <div class="exec-card">
                    <div class="exec-card-label">Profit Factor</div>
                    <div class="exec-card-value">0.00</div>
                    <div class="exec-card-subtitle">Gross profit / loss</div>
                </div>

                <div class="exec-card">
                    <div class="exec-card-label">Avg Win</div>
                    <div class="exec-card-value profit">$0.00</div>
                    <div class="exec-card-subtitle">Per winning trade</div>
                </div>

                <div class="exec-card">
                    <div class="exec-card-label">Avg Loss</div>
                    <div class="exec-card-value loss">$0.00</div>
                    <div class="exec-card-subtitle">Per losing trade</div>
                </div>

                <div class="exec-card">
                    <div class="exec-card-label">Max Win</div>
                    <div class="exec-card-value profit">$0.00</div>
                    <div class="exec-card-subtitle">Best trade</div>
                </div>

                <div class="exec-card">
                    <div class="exec-card-label">Max Loss</div>
                    <div class="exec-card-value loss">$0.00</div>
                    <div class="exec-card-subtitle">Worst trade</div>
                </div>
            </div>
        </div>
        <div class="section">
            <div class="section-title">Equity Curve</div>
            <div class="section-subtitle" id="equitySubtitle">Cumulative P&L over time: <span id="equityTotalPnl" class="neutral">$0.00</span> | Max Drawdown: <span id="equityMaxDD" class="loss">$0.00</span></div>
            <div class="chart-container">
                <canvas id="equityChart"></canvas>
            </div>
        </div>
        <div class="section">
            <div class="section-title">Performance by Pair</div>
            <div class="section-subtitle">Individual pair statistics</div>
            <div class="table-scroll">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Pair</th>
                            <th>Total</th>
                            <th>TPs</th>
                            <th>SLs</th>
                            <th>Win Rate</th>
                            <th>P&L</th>
                        </tr>
                    </thead>
                    <tbody id="performanceTableBody">
                        
                    </tbody>
                </table>
            </div>
        </div>
        <div class="section">
            <div class="section-title">Detailed Pair Analysis</div>
            <div class="section-subtitle">In-depth metrics and insights per currency pair</div>
            <div class="analysis-grid" id="analysisCardsGrid">
                
            </div>
        </div>
        <div class="section">
            <div class="section-title">Recent Trades</div>
            <div class="section-subtitle">Last 200 closed positions with all indicator data (newest first)</div>
            <div class="table-scroll">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Ticket</th>
                            <th>Pair</th>
                            <th>Type</th>
                            <th>Open Time</th>
                            <th>Close Time</th>
                            <th>Duration</th>
                            <th>Ver</th>
                            <th id="thInd1">EMA 200</th>
                            <th id="thInd2">Trend</th>
                            <th id="thInd3">RSI</th>
                            <th>ATR</th>
                            <th>Extra Indicators</th>
                            <th>Result</th>
                            <th>P&L</th>
                        </tr>
                    </thead>
                    <tbody id="tradesTableBody">
                        
                    </tbody>
                </table>
            </div>
        </div>
        <div class="section" style="text-align: center;">
            <button class="export-btn" onclick="exportToExcel()">
                ðŸ“¥ Export to Excel
            </button>
        </div>
    </div>
    <script>
        window.v1TradesData = [];
        window.v1MetricsData = {"total_trades": 0, "tp_count": 0, "sl_count": 0, "win_rate": 0.0, "total_profit": 0.0, "total_loss": 0.0, "net_pnl": 0.0, "avg_win": 0.0, "avg_loss": 0.0, "profit_factor": 0.0, "max_win": 0.0, "max_loss": 0.0, "avg_duration_hours": 0.0};
        window.v1EquityData = [];
        window.v2TradesData = [];
        window.v2MetricsData = {"total_trades": 0, "tp_count": 0, "sl_count": 0, "win_rate": 0.0, "total_profit": 0.0, "total_loss": 0.0, "net_pnl": 0.0, "avg_win": 0.0, "avg_loss": 0.0, "profit_factor": 0.0, "max_win": 0.0, "max_loss": 0.0, "avg_duration_hours": 0.0};
        window.v2EquityData = [];
        window.v3TradesData = [];
        window.v3MetricsData = {"total_trades": 0, "tp_count": 0, "sl_count": 0, "win_rate": 0.0, "total_profit": 0.0, "total_loss": 0.0, "net_pnl": 0.0, "avg_win": 0.0, "avg_loss": 0.0, "profit_factor": 0.0, "max_win": 0.0, "max_loss": 0.0, "avg_duration_hours": 0.0};
        window.v3EquityData = [];
        window.v4TradesData = [];
        window.v4MetricsData = {"total_trades": 0, "tp_count": 0, "sl_count": 0, "win_rate": 0.0, "total_profit": 0.0, "total_loss": 0.0, "net_pnl": 0.0, "avg_win": 0.0, "avg_loss": 0.0, "profit_factor": 0.0, "max_win": 0.0, "max_loss": 0.0, "avg_duration_hours": 0.0};
        window.v4EquityData = [];
        window.v5TradesData = [];
        window.v5MetricsData = {"total_trades": 0, "tp_count": 0, "sl_count": 0, "win_rate": 0.0, "total_profit": 0.0, "total_loss": 0.0, "net_pnl": 0.0, "avg_win": 0.0, "avg_loss": 0.0, "profit_factor": 0.0, "max_win": 0.0, "max_loss": 0.0, "avg_duration_hours": 0.0};
        window.v5EquityData = [];
        window.v6TradesData = [];
        window.v6MetricsData = {"total_trades": 0, "tp_count": 0, "sl_count": 0, "win_rate": 0.0, "total_profit": 0.0, "total_loss": 0.0, "net_pnl": 0.0, "avg_win": 0.0, "avg_loss": 0.0, "profit_factor": 0.0, "max_win": 0.0, "max_loss": 0.0, "avg_duration_hours": 0.0};
        window.v6EquityData = [];
        window.allTradesData = window.v1TradesData;
        function toggleNavbarControls() {
            const controls = document.getElementById('navbarControls');
            controls.classList.toggle('show');
        }
        
        const tradeDetails = [];
        window.tradeDetails = tradeDetails;

        const ctx = document.getElementById('equityChart').getContext('2d');
        window.equityChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: [],
                datasets: [{
                    label: 'Cumulative P&L',
                    data: [],
                    borderColor: '#60a5fa',
                    backgroundColor: 'rgba(96, 165, 250, 0.1)',
                    borderWidth: 2,
                    fill: true,
                    tension: 0.4,
                    pointRadius: 3,
                    pointHoverRadius: 6,
                    pointBackgroundColor: '#60a5fa',
                    pointBorderColor: '#1e293b',
                    pointBorderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                interaction: {
                    mode: 'index',
                    intersect: false
                },
                plugins: {
                    legend: {
                        display: true,
                        position: 'top',
                        labels: {
                            color: '#e2e8f0',
                            font: { size: 12, family: 'Inter' }
                        }
                    },
                    tooltip: {
                        backgroundColor: 'rgba(15, 23, 42, 0.95)',
                        titleColor: '#f1f5f9',
                        bodyColor: '#e2e8f0',
                        borderColor: '#60a5fa',
                        borderWidth: 1,
                        padding: 12,
                        displayColors: false,
                        callbacks: {
                            title: function(context) {
                                return 'Closing: ' + context[0].label;
                            },
                            label: function(context) {
                                const index = context.dataIndex;
                                const trade = window.tradeDetails ? window.tradeDetails[index] : null;
                                if (!trade) return ['Cumulative P&L: $' + context.parsed.y.toFixed(2)];
                                return [
                                    'Opening: ' + trade.open_time,
                                    '',
                                    'Trade: ' + trade.symbol + ' ' + trade.type,
                                    'P&L this trade: $' + trade.trade_pnl.toFixed(2),
                                    '',
                                    'Cumulative P&L: $' + context.parsed.y.toFixed(2)
                                ];
                            }
                        }
                    }
                },
                scales: {
                    x: {
                        ticks: {
                            color: '#94a3b8',
                            maxRotation: 45,
                            minRotation: 45,
                            autoSkip: true,
                            maxTicksLimit: 15
                        },
                        grid: { color: 'rgba(148, 163, 184, 0.1)' }
                    },
                    y: {
                        ticks: {
                            color: '#94a3b8',
                            callback: function(value) { return '$' + value.toFixed(2); }
                        },
                        grid: { color: 'rgba(148, 163, 184, 0.1)' }
                    }
                }
            }
        });
        
        function exportToExcel() {
            const allTrades = [];
            const ws = XLSX.utils.json_to_sheet(allTrades);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Trades");
            const filename = 'Rosenfeld_Trades_' + new Date().toISOString().split('T')[0] + '.xlsx';
            XLSX.writeFile(wb, filename);
        }
        
        function calculateMetrics(trades) {
            const total = trades.length;
            const tps = trades.filter(t => t.pnl > 0).length;
            const sls = trades.filter(t => t.pnl <= 0).length;
            const winRate = total > 0 ? (tps / total * 100) : 0;
            const netPnl = trades.reduce((sum, t) => sum + t.pnl, 0);
            const wins = trades.filter(t => t.pnl > 0);
            const losses = trades.filter(t => t.pnl <= 0);
            const avgWin = wins.length > 0 ? wins.reduce((sum, t) => sum + t.pnl, 0) / wins.length : 0;
            const avgLoss = losses.length > 0 ? Math.abs(losses.reduce((sum, t) => sum + t.pnl, 0) / losses.length) : 0;
            const grossProfit = wins.reduce((sum, t) => sum + t.pnl, 0);
            const grossLoss = Math.abs(losses.reduce((sum, t) => sum + t.pnl, 0));
            const profitFactor = grossLoss > 0 ? grossProfit / grossLoss : grossProfit > 0 ? 999 : 0;
            const maxWin = wins.length > 0 ? Math.max(...wins.map(t => t.pnl)) : 0;
            const maxLoss = losses.length > 0 ? Math.min(...losses.map(t => t.pnl)) : 0;

            return {
                total_trades: total, tp_count: tps, sl_count: sls, win_rate: winRate,
                net_pnl: netPnl, avg_win: avgWin, avg_loss: avgLoss,
                profit_factor: profitFactor, max_win: maxWin, max_loss: maxLoss
            };
        }
        
        function updateMetricsCards(metrics) {
            const cards = document.querySelectorAll('.exec-card');
            if (cards.length >= 8) {
                cards[0].querySelector('.exec-card-value').textContent = metrics.total_trades;

                const winRateEl = cards[1].querySelector('.exec-card-value');
                winRateEl.textContent = metrics.win_rate.toFixed(1) + '%';
                winRateEl.className = 'exec-card-value ' + (metrics.win_rate >= 50 ? 'profit' : 'loss');
                cards[1].querySelector('.exec-card-subtitle').textContent = metrics.tp_count + ' TPs vs ' + metrics.sl_count + ' SLs';

                const pnlEl = cards[2].querySelector('.exec-card-value');
                pnlEl.textContent = '$' + metrics.net_pnl.toFixed(2);
                pnlEl.className = 'exec-card-value ' + (metrics.net_pnl >= 0 ? 'profit' : 'loss');

                cards[3].querySelector('.exec-card-value').textContent = metrics.profit_factor.toFixed(2);
                cards[4].querySelector('.exec-card-value').textContent = '$' + metrics.avg_win.toFixed(2);
                cards[5].querySelector('.exec-card-value').textContent = '$' + metrics.avg_loss.toFixed(2);
                cards[6].querySelector('.exec-card-value').textContent = '$' + metrics.max_win.toFixed(2);
                cards[7].querySelector('.exec-card-value').textContent = '$' + Math.abs(metrics.max_loss).toFixed(2);
            }
        }

        function updateEquityChart(equityData, chart) {
            if (!chart || !equityData) return;

            chart.data.labels = equityData.map(p => p.date);
            chart.data.datasets[0].data = equityData.map(p => p.cumulative_pnl);

            // Update tradeDetails for tooltips
            window.tradeDetails = equityData.map(p => ({
                symbol: p.symbol, type: p.type,
                trade_pnl: p.trade_pnl, open_time: p.open_time
            }));

            chart.update();
        }

        function calculateMaxDrawdown(trades) {
            if (!trades || trades.length === 0) return { totalPnl: 0, maxDrawdown: 0 };

            const sortedTrades = [...trades].sort((a, b) =>
                new Date(a.close_time) - new Date(b.close_time)
            );

            let cumulative = 0;
            let peak = 0;
            let maxDD = 0;

            sortedTrades.forEach(t => {
                cumulative += t.pnl;
                if (cumulative > peak) peak = cumulative;
                const drawdown = peak - cumulative;
                if (drawdown > maxDD) maxDD = drawdown;
            });

            return { totalPnl: cumulative, maxDrawdown: maxDD };
        }

        function updateEquitySubtitle(trades) {
            const { totalPnl, maxDrawdown } = calculateMaxDrawdown(trades);

            const pnlEl = document.getElementById('equityTotalPnl');
            const ddEl = document.getElementById('equityMaxDD');

            if (pnlEl) {
                pnlEl.textContent = '$' + totalPnl.toFixed(2);
                pnlEl.className = totalPnl >= 0 ? 'profit' : 'loss';
            }

            if (ddEl) {
                ddEl.textContent = '$' + maxDrawdown.toFixed(2);
                ddEl.className = 'loss';
            }
        }

        function updatePairAnalysis(filteredTrades) {
            // Group trades by pair
            const byPair = {};
            filteredTrades.forEach(trade => {
                const symbol = trade.symbol.replace('m', '');
                if (!byPair[symbol]) {
                    byPair[symbol] = [];
                }
                byPair[symbol].push(trade);
            });

            // Calculate metrics per pair
            const tbody = document.getElementById('performanceTableBody');
            if (!tbody) return;

            tbody.innerHTML = '';  // Clear existing rows

            // Sort pairs alphabetically
            const sortedPairs = Object.keys(byPair).sort();

            sortedPairs.forEach(symbol => {
                const trades = byPair[symbol];
                const totalTrades = trades.length;
                const tps = trades.filter(t => t.pnl > 0).length;
                const sls = trades.filter(t => t.pnl <= 0).length;
                const winRate = totalTrades > 0 ? (tps / totalTrades * 100) : 0;
                const netPnL = trades.reduce((sum, t) => sum + t.pnl, 0);

                // Create row
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="pair-name">${symbol}</td>
                    <td>${totalTrades}</td>
                    <td class="profit">${tps}</td>
                    <td class="loss">${sls}</td>
                    <td>${winRate.toFixed(1)}%</td>
                    <td class="${netPnL >= 0 ? 'profit' : 'loss'}">$${netPnL.toFixed(2)}</td>
                `;
                tbody.appendChild(row);
            });

            // If no trades, show empty message
            if (sortedPairs.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = '<td colspan="6" style="text-align: center; color: #94a3b8;">No trades match the selected filters</td>';
                tbody.appendChild(row);
            }
        }

        function updateDetailedPairAnalysis(filteredTrades) {
            // Update the Detailed Pair Analysis cards dynamically
            const grid = document.getElementById('analysisCardsGrid');
            if (!grid) return;

            // Group trades by pair
            const byPair = {};
            filteredTrades.forEach(trade => {
                const symbol = trade.symbol.replace('m', '');
                if (!byPair[symbol]) {
                    byPair[symbol] = [];
                }
                byPair[symbol].push(trade);
            });

            // Sort pairs alphabetically
            const sortedPairs = Object.keys(byPair).sort();

            // Generate cards HTML
            let cardsHtml = '';

            sortedPairs.forEach(symbol => {
                const trades = byPair[symbol];
                const totalTrades = trades.length;
                const tps = trades.filter(t => t.pnl > 0).length;
                const sls = trades.filter(t => t.pnl <= 0).length;
                const winRate = totalTrades > 0 ? (tps / totalTrades * 100) : 0;
                const netPnL = trades.reduce((sum, t) => sum + t.pnl, 0);

                // Calculate profit factor
                const grossProfit = trades.filter(t => t.pnl > 0).reduce((sum, t) => sum + t.pnl, 0);
                const grossLoss = Math.abs(trades.filter(t => t.pnl < 0).reduce((sum, t) => sum + t.pnl, 0));
                const profitFactor = grossLoss > 0 ? (grossProfit / grossLoss) : (grossProfit > 0 ? 999.99 : 0);

                // Calculate max drawdown (simple approximation from cumulative P&L)
                let cumPnL = 0;
                let peak = 0;
                let maxDD = 0;
                trades.sort((a, b) => new Date(a.close_time) - new Date(b.close_time)).forEach(t => {
                    cumPnL += t.pnl;
                    if (cumPnL > peak) peak = cumPnL;
                    const dd = peak > 0 ? ((peak - cumPnL) / peak) * 100 : 0;
                    if (dd > maxDD) maxDD = dd;
                });

                // Calculate annual return (approximation: if we have X days of data)
                let annualReturn = 0;
                if (trades.length >= 2) {
                    const firstDate = new Date(trades[0].close_time);
                    const lastDate = new Date(trades[trades.length - 1].close_time);
                    const daysDiff = Math.max(1, (lastDate - firstDate) / (1000 * 60 * 60 * 24));
                    const dailyReturn = netPnL / daysDiff;
                    annualReturn = (dailyReturn * 365);
                } else {
                    annualReturn = netPnL * 12; // Simple monthly extrapolation
                }

                // Determine risk level
                let riskLevel = 'Low';
                let riskClass = 'low';
                if (maxDD > 30 || winRate < 30) {
                    riskLevel = 'High';
                    riskClass = 'high';
                } else if (maxDD > 15 || winRate < 45) {
                    riskLevel = 'Medium';
                    riskClass = 'medium';
                }

                // Generate insight
                let insight = '';
                if (profitFactor >= 1.5 && winRate >= 50) {
                    insight = 'Strong performer with consistent profitability.';
                } else if (profitFactor >= 1.0 && winRate >= 40) {
                    insight = 'Moderate performance. Consider position sizing.';
                } else if (winRate < 40) {
                    insight = 'Low win rate. Review entry criteria.';
                } else {
                    insight = 'Performance under review. Monitor closely.';
                }

                const annualClass = annualReturn >= 0 ? 'profit' : 'loss';
                const pnlClass = netPnL >= 0 ? 'profit' : 'loss';

                cardsHtml += `
                <div class="analysis-card">
                    <div class="analysis-header">
                        <span class="pair-name-large">${symbol}</span>
                        <span class="risk-badge ${riskClass}">${riskLevel} Risk</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Annual Return</span>
                        <span class="metric-value ${annualClass}">$${annualReturn.toFixed(2)}</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Profit Factor</span>
                        <span class="metric-value">${profitFactor.toFixed(2)}</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Win Rate</span>
                        <span class="metric-value">${winRate.toFixed(1)}%</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Max Drawdown</span>
                        <span class="metric-value loss">${maxDD.toFixed(2)}%</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Total Trades</span>
                        <span class="metric-value">${totalTrades}</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Net P&L</span>
                        <span class="metric-value ${pnlClass}">$${netPnL.toFixed(2)}</span>
                    </div>
                    <div class="analysis-insight">
                        <p>${insight}</p>
                    </div>
                </div>`;
            });

            // If no trades, show message
            if (sortedPairs.length === 0) {
                cardsHtml = '<div style="text-align: center; color: #94a3b8; padding: 40px;">No trades match the selected filters</div>';
            }

            grid.innerHTML = cardsHtml;
        }

        function updateTableHeaders(version) {
            // Update table headers based on version
            const thInd1 = document.getElementById('thInd1');
            const thInd2 = document.getElementById('thInd2');
            const thInd3 = document.getElementById('thInd3');

            if (version === 'v1' || version === 'v4' || version === 'V1' || version === 'V4') {
                if (thInd1) thInd1.textContent = 'EMA 200';
                if (thInd2) thInd2.textContent = 'Trend';
                if (thInd3) thInd3.textContent = 'RSI';
            } else {
                // V2, V3, V5, V6
                if (thInd1) thInd1.textContent = 'ATR %';
                if (thInd2) thInd2.textContent = 'ATR Signal';
                if (thInd3) thInd3.textContent = 'Direction';
            }
        }

        function updateTradesTable(trades) {
            const tbody = document.getElementById('tradesTableBody');
            if (!tbody) return;

            tbody.innerHTML = '';  // Clear existing rows

            // Update headers based on current version
            updateTableHeaders(currentVersion);

            const sortedTrades = [...trades].sort((a, b) =>
                new Date(b.close_time) - new Date(a.close_time)
            ).slice(0, 200);

            sortedTrades.forEach(t => {
                const openTime = new Date(t.open_time);
                const closeTime = new Date(t.close_time);
                const durationHours = (closeTime - openTime) / (1000 * 60 * 60);
                const hours = Math.floor(durationHours);
                const minutes = Math.floor((durationHours % 1) * 60);
                const durationStr = hours + 'h' + minutes + 'm';

                const resultClass = t.pnl > 0 ? 'profit' : 'loss';
                const typeClass = t.type === 'BUY' ? 'profit' : 'loss';
                const version = t.version || 'V1';

                // Version-specific indicator values
                let ind1Val, ind2Val, ind3Val;
                if (version === 'V1' || version === 'V4') {
                    ind1Val = t.ema200 ? t.ema200.toFixed(5) : 'N/A';
                    ind2Val = t.trend || 'N/A';
                    ind3Val = t.rsi ? t.rsi.toFixed(2) : 'N/A';
                } else {
                    ind1Val = t.atr_percent ? t.atr_percent.toFixed(2) + '%' : 'N/A';
                    ind2Val = t.atr_signal || 'N/A';
                    ind3Val = t.direction || 'N/A';
                }

                // ATR is common
                const atrVal = t.atr ? t.atr.toFixed(5) : 'N/A';

                // Extra indicators (version-specific extras)
                const extras = [];
                if (version === 'V1' || version === 'V4') {
                    if (t.rsi_pct) extras.push('RSI%=' + t.rsi_pct.toFixed(1) + '%');
                    if (t.trend_ema_pct) extras.push('TrendEMA%=' + t.trend_ema_pct.toFixed(2) + '%');
                    if (t.fator_ema) extras.push('FEMA=' + t.fator_ema);
                    if (t.fator_rsi) extras.push('FRSI=' + t.fator_rsi);
                } else {
                    if (t.direction_percent) extras.push('Dir%=' + t.direction_percent.toFixed(1) + '%');
                    if (t.fator_atr_tp) extras.push('FTP=' + t.fator_atr_tp);
                    if (t.fator_atr_sl) extras.push('FSL=' + t.fator_atr_sl);
                }
                // Common extras
                if (t.trailing_stop) extras.push('Trail=' + t.trailing_stop);
                if (t.dynamic_trailing) extras.push('DynTrail=' + t.dynamic_trailing);
                if (t.signal_30min) extras.push('30min=' + t.signal_30min);
                const extraStr = extras.length > 0 ? extras.join(', ') : 'N/A';

                const row = document.createElement('tr');
                row.setAttribute('data-version', version);
                row.innerHTML = `
                    <td>${t.ticket}</td>
                    <td class="pair-name">${t.symbol.replace('m', '')}</td>
                    <td class="${typeClass}">${t.type}</td>
                    <td>${t.open_time}</td>
                    <td>${t.close_time}</td>
                    <td>${durationStr}</td>
                    <td><span class="version-badge">${version}</span></td>
                    <td class="ind1">${ind1Val}</td>
                    <td class="ind2">${ind2Val}</td>
                    <td class="ind3">${ind3Val}</td>
                    <td>${atrVal}</td>
                    <td class="extra-indicators" title="${extraStr}">${extraStr}</td>
                    <td class="${resultClass}">${t.result}</td>
                    <td class="${resultClass}">$${t.pnl.toFixed(2)}</td>
                `;
                tbody.appendChild(row);
            });
        }
        
        let currentVersion = 'v1';

        function switchVersion(version) {
            currentVersion = version;

            // Update button states
            document.querySelectorAll('.version-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById('btn' + version.toUpperCase()).classList.add('active');

            // Get version-specific data
            let tradesData, metricsData, equityData;
            let versionTitle = '';

            switch(version) {
                case 'v1':
                    tradesData = window.v1TradesData || [];
                    metricsData = window.v1MetricsData || {};
                    equityData = window.v1EquityData || [];
                    versionTitle = 'V1 (EMA200 + RSI%)';
                    break;
                case 'v2':
                    tradesData = window.v2TradesData || [];
                    metricsData = window.v2MetricsData || {};
                    equityData = window.v2EquityData || [];
                    versionTitle = 'V2 (ATR% + Direction)';
                    break;
                case 'v3':
                    tradesData = window.v3TradesData || [];
                    metricsData = window.v3MetricsData || {};
                    equityData = window.v3EquityData || [];
                    versionTitle = 'V3 (ATR% + Trailing)';
                    break;
                case 'v4':
                    tradesData = window.v4TradesData || [];
                    metricsData = window.v4MetricsData || {};
                    equityData = window.v4EquityData || [];
                    versionTitle = 'V4 (EMA + RSI + Trailing)';
                    break;
                case 'v5':
                    tradesData = window.v5TradesData || [];
                    metricsData = window.v5MetricsData || {};
                    equityData = window.v5EquityData || [];
                    versionTitle = 'V5 (ATR% + 30min)';
                    break;
                case 'v6':
                    tradesData = window.v6TradesData || [];
                    metricsData = window.v6MetricsData || {};
                    equityData = window.v6EquityData || [];
                    versionTitle = 'V6 (Dynamic Trailing)';
                    break;
            }

            // Update title
            const titleEl = document.querySelector('.navbar h1');
            if (titleEl) titleEl.textContent = 'Trader Rosenfeld - ' + versionTitle;

            // Store current trades for filters
            window.allTradesData = tradesData;

            // Update dashboard components
            updateMetricsCards(metricsData);
            updatePairAnalysis(tradesData);
            updateDetailedPairAnalysis(tradesData);
            updateEquityChart(equityData, window.equityChart);
            updateTradesTable(tradesData);
            updateEquitySubtitle(tradesData);

            // Update filter counts
            const totalCountEl = document.getElementById('totalCount');
            const filteredCountEl = document.getElementById('filteredCount');
            if (totalCountEl) totalCountEl.textContent = tradesData.length;
            if (filteredCountEl) filteredCountEl.textContent = tradesData.length;

            // Reset filters
            resetFilters();
        }
        
        function togglePairDropdown() {
            const dropdown = document.getElementById('pairDropdownOptions');
            dropdown.classList.toggle('show');
        }

        function handlePairSelection(checkbox) {
            const allCheckbox = document.querySelector('.dropdown-option input[value="ALL"]');
            const individualCheckboxes = Array.from(document.querySelectorAll('.dropdown-option input:not([value="ALL"])'));

            if (checkbox.value === 'ALL') {
                individualCheckboxes.forEach(cb => cb.checked = checkbox.checked);
            } else {
                const allIndividualsChecked = individualCheckboxes.every(cb => cb.checked);
                allCheckbox.checked = allIndividualsChecked;
            }

            updateDropdownText();
            applyFilters();
        }

        function updateDropdownText() {
            const allCheckbox = document.querySelector('.dropdown-option input[value="ALL"]');
            const individualCheckboxes = Array.from(document.querySelectorAll('.dropdown-option input:not([value="ALL"])'));
            const checkedCount = individualCheckboxes.filter(cb => cb.checked).length;
            const dropdownText = document.getElementById('pairDropdownText');

            if (allCheckbox.checked) {
                dropdownText.textContent = 'Todos os pares';
            } else if (checkedCount === 0) {
                dropdownText.textContent = 'Selecione pares';
            } else if (checkedCount === 1) {
                const checkedPair = individualCheckboxes.find(cb => cb.checked);
                dropdownText.textContent = checkedPair.value;
            } else {
                dropdownText.textContent = `${checkedCount} pares`;
            }
        }

        function resetFilters() {
            document.querySelectorAll('.dropdown-option input').forEach(cb => cb.checked = true);
            updateDropdownText();

            const dateFrom = document.getElementById('dateFrom');
            const dateTo = document.getElementById('dateTo');
            if (dateFrom && dateTo) {
                dateFrom.value = dateFrom.getAttribute('value');
                dateTo.value = dateTo.getAttribute('value');
            }

            applyFilters();
        }

        document.addEventListener('click', function(event) {
            const dropdown = document.getElementById('pairDropdown');
            if (dropdown && !dropdown.contains(event.target)) {
                document.getElementById('pairDropdownOptions').classList.remove('show');
            }
        });
        
        function applyFilters() {
            const individualCheckboxes = Array.from(document.querySelectorAll('.dropdown-option input:not([value="ALL"])'));
            const selectedPairs = individualCheckboxes
                .filter(cb => cb.checked)
                .map(cb => cb.value);

            const pairsToFilter = selectedPairs.length === 0 ? individualCheckboxes.map(cb => cb.value) : selectedPairs;

            const dateFrom = document.getElementById('dateFrom')?.value;
            const dateTo = document.getElementById('dateTo')?.value;

            const allTrades = window.allTradesData || [];

            const filteredTrades = allTrades.filter(trade => {
                const symbol = trade.symbol.replace('m', '');
                if (!pairsToFilter.includes(symbol)) return false;

                if (dateFrom && trade.close_time < dateFrom.replace('T', ' ') + ':00') return false;
                if (dateTo && trade.close_time > dateTo.replace('T', ' ') + ':59') return false;

                return true;
            });

            document.getElementById('filteredCount').textContent = filteredTrades.length;
            updateDashboard(filteredTrades);
        }

        function updateDashboard(filteredTrades) {
            const metrics = calculateMetrics(filteredTrades);
            updateMetricsCards(metrics);
            updatePairAnalysis(filteredTrades);
            updateDetailedPairAnalysis(filteredTrades);
            updateTradesTable(filteredTrades);

            // Calculate equity curve from filtered trades
            const sortedTrades = [...filteredTrades].sort((a, b) =>
                new Date(a.close_time) - new Date(b.close_time)
            );

            let cumulative = 0;
            const equityData = sortedTrades.map(t => {
                cumulative += t.pnl;
                return {
                    date: t.close_time,
                    cumulative_pnl: cumulative,
                    symbol: t.symbol,
                    type: t.type,
                    trade_pnl: t.pnl,
                    open_time: t.open_time
                };
            });

            updateEquityChart(equityData, window.equityChart);
            updateEquitySubtitle(filteredTrades);
        }
        
        updateEquitySubtitle(window.allTradesData);
    </script>
</body>
</html>